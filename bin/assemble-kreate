#!/bin/env bash

dir=$(dirname $(dirname $(readlink -f ${BASH_SOURCE[0]})))

file="${1:-kreate}"
sed -e '/^main "${@}"/d' \
    -e '/^[ ]*source_files_from_lib$/d' \
    -e '/^source_files_from_lib() {/,/^}$/d' \
    "$dir"/main-kreate >"$file"
for lib in "$dir"/lib/*.lib; do
    echo adding $lib
    printf '\n#####################################\n# %s\n' $(basename $lib) >>"$file"
    cat $lib  >>"$file"
done
printf '\n#####################################\nmain "${@}"\n' >>"$file"
chmod 755 "$file"
