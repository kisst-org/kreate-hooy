#####################################
# git module


init_module_git() {
    declare -g used_files=""
    aliases[deploy]="run:git-pull,update,render,kube-diff,git-diff,ask,git-add,git-commit to:deployed/manifests"
    declare -g git_pulled=false
    enabled[git-pull]=false
    enabled[kube-apply]=false
    enabled[git-commit]=false
}

run_action_ask() {
    local answer
    read -p "do you want to continue?" answer
}

run_action_git-pull() {
    if "${git_pulled}"; then return 0; fi
    git_pulled=true
    verbose_cmd git pull
}

run_action_git-diff() {
    if $(log_is_verbose); then
        verbose_cmd git diff -- ${used_files} ${output_dir} || true
    else
        verbose_cmd git diff -- ${used_files} ${output_dir} | grep -E '^[+-] |^---' || true
    fi
}

run_action_git-add() {
    verbose_cmd git add "${used_files} ${output_dir}"
}

run_action_git-status() {
    git status
}


run_action_git-commit() {
    info git commit -m "${action} of ${appname} on ${env}" "${used_files} ${output_dir}"
}
